<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>Asyncå’ŒAwaitç”¨æ³•ä»¥åŠPromiseçš„ç†è§£ | pybæ°¸æ³¢çš„æŠ€æœ¯åšå®¢</title>
<meta name="description" content="æ¸©æ•…è€ŒçŸ¥æ–°">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">


<link rel="shortcut icon" href="https://blog.901web.com/favicon.ico?v=1700564855826">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://blog.901web.com/styles/main.css">



<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>

<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />



  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://blog.901web.com">
        <img src="https://blog.901web.com/images/avatar.png?v=1700564855826" class="site-logo">
        <h1 class="site-title">pybæ°¸æ³¢çš„æŠ€æœ¯åšå®¢</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            é¦–é¡µ
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            å½’æ¡£
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            æ ‡ç­¾
          </a>
        
      
        
          <a href="/post/mylife" class="site-nav">
            ç”Ÿæ´»
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            å…³äº
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
          <a class="social-link" href="https://github.com/pybyongbo" target="_blank">
            <i class="fab fa-github"></i>
          </a>
        
      
        
          <a class="social-link" href="https://github.com/pybyongbo" target="_blank">
            <i class="fab fa-twitter"></i>
          </a>
        
      
        
          <a class="social-link" href="https://github.com/pybyongbo" target="_blank">
            <i class="fab fa-weibo"></i>
          </a>
        
      
        
          <a class="social-link" href="https://github.com/pybyongbo" target="_blank">
            <i class="fab fa-zhihu"></i>
          </a>
        
      
        
          <a class="social-link" href="https://github.com/pybyongbo" target="_blank">
            <i class="fab fa-facebook"></i>
          </a>
        
      
    </div>
    <div class="site-description">
      æ¸©æ•…è€ŒçŸ¥æ–°
    </div>
    <div class="site-footer">
      Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | <a class="rss" href="https://blog.901web.com/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">Asyncå’ŒAwaitç”¨æ³•ä»¥åŠPromiseçš„ç†è§£</h2>
            <div class="post-date">2018-09-08 10:09:53</div>
            
            <div class="post-content">
              <p>å¼‚æ­¥æ“ä½œæ˜¯ Javascript ç¼–ç¨‹çš„éº»çƒ¦äº‹,éº»çƒ¦åˆ°ä¸€ç›´æœ‰äººæå‡ºå„ç§å„æ ·çš„æ–¹æ¡ˆ,è¯•å›¾æ¥è§£å†³è¿™ä¸ªé—®é¢˜,ä»æœ€æ—©çš„å›è°ƒå‡½æ•°,åˆ°<code>Promise</code>,åˆ° ES7 çš„<code>async</code>å’Œ<code>await</code>,æ¯æ¬¡éƒ½æœ‰æ”¹è¿›,ä½†åˆè®©äººè§‰å¾—ä¸å½»åº•,ä»–ä»¬éƒ½æœ‰é¢å¤–çš„å¤æ‚æ€§,éƒ½éœ€è¦ç†è§£æŠ½è±¡åº•å±‚è¿è¡Œæœºåˆ¶.</p>
<p>ES7 å¼•å…¥çš„ async/await æ˜¯ Javascript å¼‚æ­¥ç¼–ç¨‹çš„ä¸€ä¸ªé‡å¤§æ”¹è¿›.æä¾›äº†åœ¨ä¸é˜»å¡ä¸»çº¿ç¨‹çš„æƒ…å†µä¸‹ä½¿ç”¨åŒæ­¥ä»£ç å¼‚æ­¥è®¿é—®èµ„æºçš„èƒ½åŠ›,asyncå¯ä»¥è®©ä¸€ä¸ªæ–¹æ³•å˜æˆå¼‚æ­¥,awaitå¿…é¡»ç”¨åœ¨çˆ±ä¸Šä¸€å¹´ä»å†…éƒ¨,ä¸‹é¢ç»“åˆè‡ªå·±å®é™…é¡¹ç›®ä¸­é‡åˆ°çš„é—®é¢˜,å’Œè‡ªå·±å¯¹å®ƒçš„ä¸€äº›ç†è§£,å°†ä»ä¸åŒçš„å®ä¾‹è¯´æ˜ async/await çš„ç”¨æ³•:</p>
<!-- more -->
<h3 id="asyncawait-çš„å¥½å¤„">async/await çš„å¥½å¤„</h3>
<p>async/await ç»™æˆ‘ä»¬å¸¦æ¥çš„é‡è¦å¥½å¤„æ˜¯åŒæ­¥ç¼–ç¨‹é£æ ¼.çœ‹ä¸‹ä¸‹é¢çš„ä¾‹å­:</p>
<pre><code class="language-javascript">// async/await
async getBooksByAuthorwithAwait(authorId) {

  const books = await bookModel.fetchAll(); //æ¥å£è·å–æ•°æ®æ–¹æ³•

  return books.fillter(b=&gt;{b.authorId === authorId})

}
//Promise

getBooksByAuthorwithAwait(authorId) {
  return bookModel.fetchAll().then(books=&gt;books.fillter(b=&gt;{
      b.authorId === authorId
  }))
}
</code></pre>
<p>å¾ˆæ˜¾ç„¶,async/await æ¯” Promise æ›´å®¹æ˜“ç†è§£,å¦‚æœå¿½ç•¥æ‰ await å…³é”®å­—,ä»£ç çœ‹èµ·æ¥ä¸å…¶ä»–ä»»æ„ä¸€é—¨åŒæ­¥è¯­è¨€ä¸€æ ·.</p>
<p>å¦å¤–ä¸€ä¸ªå¥½å¤„æ˜¯ async å…³é”®å­—,å°½ç®¡çœ‹èµ·æ¥ä¸æ˜¯å¾ˆæ˜æ˜¾,å®ƒç”³æ˜ getBooksByAuthorwithAwait() å‡½æ•°çš„è¿”å›å€¼çš„æ˜¯ä¸€ä¸ª Promise,å› æ­¤è°ƒç”¨è€…å¯ä»¥å®‰å…¨çš„è°ƒç”¨</p>
<p>getBooksByAuthorwithAwait().then(...) æˆ– await getBooksByAuthorwithAwait().æ¯”å¦‚åƒä¸‹é¢è¿™æ ·çš„ä»£ç :</p>
<pre><code class="language-javascript">getBooksByAuthorWithPromise(authorId) {

  if(!authorId) {
    return null
  }

  return bookModel.fetAll().then(books=&gt;books.fillter(b=&gt;b.authorId === authorId))
}
</code></pre>
<p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­,getBooksByAuthorWithPromise å¯èƒ½è¿”å›ä¸€ä¸ª Promise(æ­£å¸¸æƒ…å†µ) æˆ– null(å¼‚å¸¸æƒ…å†µ),åœ¨è¿™ç§æƒ…å†µä¸‹,è°ƒç”¨è€…æ— æ³•å®‰å…¨çš„è°ƒç”¨.then().è€Œå¦‚æœä½¿ç”¨ async å£°æ˜,åˆ™ä¸ä¼šå‡ºç°è¿™ç§æƒ…å†µ.</p>
<p>async/await æ˜¯ä¸€ç§æ”¹è¿›,ä½†å®ƒä¸è¿‡æ˜¯ä¸€ç§è¯­æ³•ç³–,ä»–ä¸ä¼šå®Œå…¨æ”¹å˜æˆ‘ä»¬çš„ç¼–ç¨‹é£æ ¼.ä»æœ¬è´¨ä¸Šè®²,å¼‚æ­¥å‡½æ•°ä»ç„¶æ˜¯ Promise,åœ¨æ­£ç¡®çš„ä½¿ç”¨å¼‚æ­¥å‡½æ•°ä¹‹å‰,ä½ å¿…é¡»äº†è§£ Promise,æ›´ç³Ÿç³•çš„æ˜¯,å¤§éƒ¨åˆ†æ—¶é—´éœ€è¦åŒæ—¶ä½¿ç”¨ Promise å’Œå¼‚æ­¥å‡½æ•°.</p>
<p>è™½ç„¶ await å¯ä»¥è®©ä½ çš„ä»£ç çœ‹èµ·æ¥åƒæ˜¯åŒæ­¥çš„,ä½†è¯·è®°ä½,å®ƒä»ç„¶æ˜¯å¼‚æ­¥çš„.</p>
<p>åœ¨åšå…¬å¸é¡¹ç›® SAAS ç³»ç»Ÿçš„æ—¶å€™,å°±é‡åˆ°äº†ç›¸å…³çš„é—®é¢˜.ç¼–è¾‘ SKU ä¿¡æ¯,è¿›è¡Œä¿å­˜çš„æ“ä½œ.è¦åˆ¤æ–­æ˜¯å¦æœ‰é‡å¤çš„ sku ä¿¡æ¯,ç„¶åå‰ç«¯è¿›è¡Œæ“ä½œæç¤º.ç„¶è€Œè‡ªå·±å¯¹åŸºç¡€çŸ¥è¯†ç†è§£çš„ä¸é€å½»,å¯¼è‡´æŠ˜è…¾äº†å¥½ä¸€ä¼šå„¿(åŸºäº Vue+ElemeUI æ¡†æ¶).</p>
<p>å…ˆçœ‹ä¸‹å®é™…çš„é¡µé¢æ•ˆæœå§,æˆ‘æˆªäº†ä¸ªå›¾,æ­¤å¤„è¡¨å•å› ä¸ºå¤šå¤„ä½¿ç”¨,åˆ†ç¦»æˆäº†ä¸€ä¸ª vue çš„ç»„ä»¶å¼•ç”¨.</p>
<p>é¡¹ç›®æˆªå›¾:<br>
<img src="https://images.901web.com/hexoblog/saas_1.png" alt="ç¼–è¾‘skuä¿å­˜" title="ç¼–è¾‘skuä¿å­˜" loading="lazy"></p>
<p>ç‚¹å‡»ä¿å­˜æ–¹æ³•:</p>
<pre><code class="language-javascript">//ä¿å­˜skuä¿¡æ¯æ–¹æ³•(è¦åŒºåˆ†æ–°å¢ä¿å­˜è¿˜æ˜¯ç¼–è¾‘ä¿å­˜æ“ä½œ,æ–°å¢å‰ç«¯æ“ä½œæ•°ç»„ï¼Œç¼–è¾‘ä¿å­˜è°ƒåç«¯æ¥å£ã€‚)
async saveskuinfoData() {
      const sukItemSend = Object.assign({}, this.$refs.skuInfo.skuForm);
      sukItemSend.productId = this.$route.query.productId;
      this.$refs.skuInfo.editproskuRule();
      if (this.$refs.skuInfo.formFlag) {
        //éªŒè¯è¡¨å•é€šè¿‡
        // sukItemSend.skuId ===0 è¡¨ç¤ºæ–°å¢æ·»åŠ sku,ä¸ç­‰äº0è¡¨ç¤ºç¼–è¾‘sku;
        this.submitskuDisabled = true;

        if (this.isSkuExist(sukItemSend) &amp;&amp; sukItemSend.skuId === 0) {
          this.$message({
            message: &quot;è¯·ä¸è¦é‡å¤æ·»åŠ ç›¸åŒSKUä¿¡æ¯&quot;,
            type: &quot;warning&quot;
          });
          this.submitskuDisabled = false;
          return false;

        } else if (sukItemSend.skuId !== 0 &amp;&amp; await this.isValidateIsExist(sukItemSend))  {
          //ç¼–è¾‘skuä¿å­˜æƒ…å†µ ,æ­¤å¤„å†™äº†await,ç­‰å¾…å¼‚æ­¥this.isValidateIsExist(sukItemSend)æ–¹æ³•ç»“æœæœ‰è¿”å›äº†,åœ¨æ‰§è¡Œä¸‹é¢çš„ä»£ç ,å¦‚æœ saveskuinfoData æ–¹æ³•å‰ä¸åŠ  async ç¼–è¾‘å™¨ä¼šæŠ¥é”™
          // this.isValidateIsExist(sukItemSend).then(res=&gt;{
          //     console.log(res)
          // });

          this.$message({
            message: 'è¯·ä¸è¦é‡å¤æ·»åŠ ç›¸åŒSKUä¿¡æ¯',
            type: &quot;warning&quot;
          });
          this.submitskuDisabled = false;
          return false;

        } else {
          updateSku(sukItemSend).then(response =&gt; {
            this.handleEditSkuinfoDialogClose();
            //æ–°å¢æ–¹æ³•ä¿®æ”¹åªå–å•†å“è¯¦æƒ…é‡Œé¢çš„skuä¿¡æ¯åˆ—è¡¨æ•°æ®
            this.submitskuDisabled = false;
            this.updateproskuinfo(this.$route.query.productId);
          });
        }
      }
    },

//è°ƒæ¥å£åˆ¤æ–­æ˜¯å¦æœ‰é‡å¤çš„sku,å¼‚æ­¥æ–¹æ³•

async isValidateIsExist(sku) {
      //æ‰æ¥å£è¿”å›æ˜¯å¦æœ‰é‡å¤skuæ–¹æ³•
      let response =  await validateIsExist({
          id: sku.id,
          numUnit: sku.numUnit,
          packNum: sku.packNum,
          packUnit: sku.packUnit,
          productId: sku.productId,
          sellType: sku.sellType,
          tradeType: sku.tradeType
        })
        if(response.status === 200) {

            if(response.data.code === 1) {
                return true;
            } else {
                return false;
            }
        } else {

          this.$message({
            message: response.data.msg,
            type: &quot;error&quot;
          });

        }

    },
</code></pre>
<p>ç‚¹å‡»ç¼–è¾‘æ“ä½œ,åŸºæœ¬æ€è·¯æµç¨‹å›¾è¯´æ˜:<br>
<img src="https://images.901web.com/hexoblog/note1.png" alt="ç¼–è¾‘æµç¨‹å›¾" title="å¼¹æ¡†ä¿¡æ¯æµç¨‹" loading="lazy"></p>
<p>æˆ–è€…ç›´æ¥åœ¨ç¼–è¾‘ä¿å­˜çš„æƒ…å†µä¸‹,è°ƒç”¨ åˆ¤æ–­ sku æ˜¯å¦æœ‰é‡å¤çš„æ–¹æ³• (å¼‚æ­¥),ä¹Ÿæ˜¯ä¸€æ ·çš„.æç¤ºä¿¡æ¯å¯ä»¥ç”¨åç«¯è¿”å›çš„æç¤ºè¯­.</p>
<pre><code class="language-javascript">saveskuinfoData() {
      const sukItemSend = Object.assign({}, this.$refs.skuInfo.skuForm);
      sukItemSend.productId = this.$route.query.productId;
      this.$refs.skuInfo.editproskuRule();
      if (this.$refs.skuInfo.formFlag) {
        //éªŒè¯è¡¨å•é€šè¿‡,sukItemSend.skuId ===0 è¡¨ç¤ºæ–°å¢æ·»åŠ sku,ä¸ç­‰äº0è¡¨ç¤ºç¼–è¾‘sku;
        this.submitskuDisabled = true;
        if (this.isSkuExist(sukItemSend) &amp;&amp; sukItemSend.skuId === 0) {
          this.$message({
            message: &quot;è¯·ä¸è¦é‡å¤æ·»åŠ ç›¸åŒSKUä¿¡æ¯&quot;,
            type: &quot;warning&quot;
          });
          this.submitskuDisabled = false;
          return false;

        } else if (sukItemSend.skuId !== 0 )  { //ç¼–è¾‘skuä¿å­˜æƒ…å†µ ,åˆ¤æ–­æ˜¯å¦æœ‰é‡å¤çš„

          //ç›´æ¥è°ƒç”¨ skuæ˜¯å¦æœ‰é‡å¤çš„æ–¹æ³• (åç«¯æ¥å£å¼‚æ­¥è¯·æ±‚,æ­¤å¤„æ²¡æœ‰ç”¨åˆ°async/await)
          this.isValidateIsExist(sukItemSend);

        } else {
          updateSku(sukItemSend).then(response =&gt; {
            this.handleEditSkuinfoDialogClose();
            //æ–°å¢æ–¹æ³•ä¿®æ”¹åªå–å•†å“è¯¦æƒ…é‡Œé¢çš„skuä¿¡æ¯åˆ—è¡¨æ•°æ®
            this.submitskuDisabled = false;
            this.updateproskuinfo(this.$route.query.productId);
          });
        }
      }
    },
    async isValidateIsExist(sku) {
      //æ‰æ¥å£è¿”å›æ˜¯å¦æœ‰é‡å¤skuæ–¹æ³•
      let response =  await validateIsExist({
          id: sku.id,
          numUnit: sku.numUnit,
          packNum: sku.packNum,
          packUnit: sku.packUnit,
          productId: sku.productId,
          sellType: sku.sellType,
          tradeType: sku.tradeType
        })

        if(response.status === 200) {

            if(response.data.code === 1) { //æœ‰é‡å¤skuä¿¡æ¯æç¤º

                 this.$message({
                  message: response.data.msg,
                  type: &quot;warning&quot;
                });
                this.submitskuDisabled = false;
                return false;


            } else { //æ²¡æœ‰é‡å¤çš„sku,æ›´æ–°æ“ä½œ

                updateSku(sku).then(response =&gt; {
                  this.handleEditSkuinfoDialogClose();
                  //æ–°å¢æ–¹æ³•ä¿®æ”¹åªå–å•†å“è¯¦æƒ…é‡Œé¢çš„skuä¿¡æ¯åˆ—è¡¨æ•°æ®
                  this.submitskuDisabled = false;
                  this.updateproskuinfo(this.$route.query.productId);
                });

            }
        } else {

          this.$message({
            message: response.data.msg,
            type: &quot;error&quot;
          });

        }

    },
</code></pre>
<h3 id="å…¶ä»–æ¨¡å—å¼•ç”¨æ–¹æ³•">å…¶ä»–æ¨¡å—å¼•ç”¨æ–¹æ³•</h3>
<p>çœ‹äº†ä¸€ä¸‹é¡¹ç›®ä¸­,å…¶ä»–å°ä¼™ä¼´çš„æ¨¡å—,éƒ½åœ¨å¤§é‡çš„ä½¿ç”¨æ–°è¯­æ³•,è‡ªå·±ä¹Ÿè¦å¤šç”¨èµ·æ¥.ç»Ÿä¸€ä»£ç é£æ ¼,å‘å¤§ä½¬ä»¬é é½.å“ˆå“ˆ ğŸ˜</p>
<p>é¡¹ç›®æˆªå›¾:<br>
<img src="https://images.901web.com/hexoblog/saaa_2.png" alt="å…¶ä»–æ¨¡å—" title="å…¶ä»–æ¨¡å—" loading="lazy"></p>
<p>é€šè¿‡æ­¤æ¬¡é—®é¢˜çš„æ€»ç»“å’Œå½’çº³,ä¹ŸåŠ æ·±äº†è‡ªå·±å¯¹å¼‚æ­¥çš„ä¸€ä¸ªç†è§£,ä»¥åŠå®ƒçš„ä¸€ä¸ªæµç¨‹.æ–°çš„ä¸œè¥¿æµè¡Œèµ·æ¥,ä¸€å®šæœ‰å®ƒçš„ä¼˜ç‚¹å’Œå¥½å¤„.æ‰€ä»¥è‡ªå·±ä¹Ÿè¦ä¸æ–­çš„å­¦ä¹ .</p>
<p>ES7 å¼•å…¥çš„ async/await å…³é”®å­—ç»å¯¹æ˜¯å¯¹ Javascript å¼‚æ­¥ç¼–ç¨‹çš„é‡å¤§æ”¹è¿›.å®ƒè®©ä»£ç æ›´æ˜“äºé˜…è¯»å’Œè°ƒè¯•.ç„¶è€Œè¦æ­£ç¡®çš„ä½¿ç”¨å®ƒä»¬,å¿…é¡»äº†è§£ Promise.å®ƒä»¬ä¸è¿‡æ˜¯è¯­æ³•ç³–,æœ¬è´¨ä¸Šä»ç„¶æ˜¯ Promise.</p>

            </div>
            
              <div class="tag-container">
                
                  <a href="https://blog.901web.com/tag/async-he-await/" class="tag">
                    Asyncå’ŒAwait
                  </a>
                
                  <a href="https://blog.901web.com/tag/yi-bu-cao-zuo/" class="tag">
                    å¼‚æ­¥æ“ä½œ
                  </a>
                
              </div>
            
            
              <div class="next-post">
                <div class="next">ä¸‹ä¸€ç¯‡</div>
                <a href="https://blog.901web.com/post/-yOfZODvD/">
                  <h3 class="post-title">
                    æ–‡ä»¶ä¸Šä¼ çº¿ä¸Šbugæ’æŸ¥è®°å½•
                  </h3>
                </a>
              </div>
            

            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>

<script type="application/javascript">

AOS.init();

hljs.initHighlightingOnLoad()

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>




  </body>
</html>
